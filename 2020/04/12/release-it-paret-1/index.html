<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author" content="张宇辰 (pw)"><title>Release It 读书笔记, 第一部分 · 张宇辰的博客</title><meta name="description" content="系统失效一定会发生。

生产环境的生存法则
系统稳定性的两个要求:

预防那些能够预防的事情
系统在整体上能够从任何未曾预料到的重创中恢复过来



设计决策和架构决策（这两个应该是一个意思，设计即架构），也是财务决策。设计/架构，本质上是业务问题，或者说是商业问题。


两种架构:

侧重对系统更"><meta name="keywords"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="short icon" href="/images/favicon.png" type="image/x-icon"><link rel="stylesheet" href="/css/style.v1.css"><link rel="stylesheet" href="/css/blog_basic.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"><meta name="generator" content="Hexo 4.2.0"></head><body><div class="sidebar"><div class="image-info">2019 年夏 @ 内蒙响沙湾</div><div class="logo-title"><div class="title"><img src="/images/logo@2x.png" style="width:127px;border-radius:127px"><h3 title="" style="margin-top: 0.5em"><a href="/">张宇辰的博客</a></h3><div class="description"><p>10 年程序员</p></div></div></div><ul class="social-links"></ul></div><div class="main"><div class="page-top animated fadeInDown"><div class="nav"><li><a href="/">首页</a></li><li><a href="/archives">归档</a></li></div><div class="information"><div class="back_btn"><li><a class="fa fa-chevron-left" onclick="window.history.go(-1)"> </a></li></div></div></div><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post animated fadeInDown"><div class="post-title"><h1><a href="/2020/04/12/release-it-paret-1/">Release It 读书笔记, 第一部分</a></h1></div><div class="post-content"><blockquote>
<p>系统失效一定会发生。</p>
</blockquote>
<h1 id="生产环境的生存法则"><a href="#生产环境的生存法则" class="headerlink" title="生产环境的生存法则"></a>生产环境的生存法则</h1><blockquote>
<p>系统稳定性的两个要求:</p>
<ol>
<li>预防那些能够预防的事情</li>
<li>系统在整体上能够从任何未曾预料到的重创中恢复过来</li>
</ol>
</blockquote>
<blockquote>
<p>设计决策和架构决策（这两个应该是一个意思，设计即架构），也是财务决策。<br>设计/架构，本质上是业务问题，或者说是商业问题。</p>
</blockquote>
<blockquote>
<p>两种架构:</p>
<ol>
<li>侧重对系统更高层次的抽象，很难与一些系统中难以处理的细节产生联系 — 象牙塔架构师，这些人享受绝对完美的最终状态。</li>
<li>务实的架构师，不仅和程序员接触，也把自己当作程序员。不断思考动态变化，深入每一个难缠的细节来考虑整个架构。</li>
</ol>
</blockquote>
<blockquote>
<p>务实的架构师所设计的系统，其中每个组件都足以满足当前的负荷。并且，当负荷随着时间的推移发生变化时，架构师知道要替换哪些组件。</p>
</blockquote>
<p>架构的最佳实践应该是动态的，警惕那些「无脑 xx 样就可以了」的设计，这个实践往往忽视了业务的状态、团队的状态和执行的人的因素。一个犯过的典型错误就是 rock 层的设计与拆分。</p>
<h1 id="案例研究：让航空公司停飞的代码异常"><a href="#案例研究：让航空公司停飞的代码异常" class="headerlink" title="案例研究：让航空公司停飞的代码异常"></a>案例研究：让航空公司停飞的代码异常</h1><blockquote>
<p>如何预防故障呢？常见的思路:</p>
<ol>
<li>CodeReview 能否发现？CodeReview 可以传播好的代码实践，可以促进设计在团队内的共识，但它并不能发现所有的故障</li>
<li>更多的测试？总有些问题是 case 没有覆盖的，这些问题是只有知道问题的情况下，才能有 case 去覆盖</li>
</ol>
</blockquote>
<p>软件缺陷一定会产生，无法被消灭。问题在于: 如何控制影响范围，以及如何从故障中恢复。</p>
<h1 id="让系统稳定运行"><a href="#让系统稳定运行" class="headerlink" title="让系统稳定运行"></a>让系统稳定运行</h1><blockquote>
<p>威胁系统寿命的主要敌人是内存泄漏和数据增长 。</p>
</blockquote>
<blockquote>
<p>编写寿命测试，或者至少测试那些重要的组件。如果这些都不做，生产环境就会成为寿命测试环境。</p>
</blockquote>
<p>紧耦合会加速裂纹的蔓延。MQ 是一个常见的裂纹阻断模式。</p>
<p>系统失效可能性的考虑过程中，几个很容易出问题的点: 外部调用、IO 操作、对资源的使用。单体服务可以缩减外部调用的次数，系统失误的原因一下减少了 33%!</p>
<h1 id="稳定性的反模式"><a href="#稳定性的反模式" class="headerlink" title="稳定性的反模式"></a>稳定性的反模式</h1><p>关键词: 紧耦合、故障扩散、雪崩</p>
<p>蜘蛛图与蝴蝶图: 软件设计中的两大问题，分层、解耦，让随意设置的蜘蛛图变为精心设计的蜘蛛图。什么是随意？「无脑 xxx」很可能就是一个随意的Flag</p>
<p>系统失效会迅速蔓延。::我们有很多次故障都是因为 MySQL 的瞬时连接压力（冲击）造成数据库变慢，稳定性的裂纹逐渐影响到其他服务，最终导致客户端重试，进而引发雪崩::</p>
<p>其他的一些点</p>
<ul>
<li>应该总是监视缓存的命中率，但不幸的是，我们现在并没有这样的基础设施。</li>
<li>整点的 cron job，应该随机摆动一个值来避免「一窝蜂」效应。</li>
<li>谨慎无限长的结果集。印象中这个坑也搞过我们很多次。</li>
</ul>
<h1 id="稳定性的模式"><a href="#稳定性的模式" class="headerlink" title="稳定性的模式"></a>稳定性的模式</h1><blockquote>
<p>用于错误处理的代码会增强系统的韧性，系统的用户可能不会因此而感激你，系统不发生停机就没人会留意你，但你晚上能睡的更好。</p>
</blockquote>
</div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2020-04-12</span><i class="fa fa-tag"></i><a class="tag" href="/tags/系统设计/" title="系统设计">系统设计 </a><a class="tag" href="/tags/读书笔记/" title="读书笔记">读书笔记 </a></div></div></div></div><div class="pagination"><ul class="clearfix"><li class="pre pagbuttons"><a class="btn" role="navigation" href="/2020/04/17/getting-close-to-glitch/" title="关于故障指标">上一篇</a></li><li class="next pagbuttons"><a class="btn" role="navigation" href="/2014/06/22/0-second-reload-for-node-web-server/" title="平滑升级 Node Web 服务器">下一篇</a></li></ul></div></div></div></div></div></body></html>