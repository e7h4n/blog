<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author" content="张宇辰 (pw)"><title>Grunt -- 最好的前端构建框架 · 张宇辰的博客</title><meta name="description" content="每个前端开发工程师都会遇到前端文件打包、压缩的问题。
Shell -&amp;gt; Ant -&amp;gt; Jake最开始，我是用 shell 脚本调用 yuicompressor、cssmin 来压缩文件，非常简单，就像这样：
1234567#!/usr/bin/env bashcat src/a.js s"><meta name="keywords"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="short icon" href="/images/favicon.png" type="image/x-icon"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/blog_basic.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"><meta name="generator" content="Hexo 4.2.0"></head><body><div class="sidebar animated fadeInDown"><div class="image-info">2019 年夏 @ 内蒙响沙湾</div></div><div class="main"><div class="page-top animated fadeInDown"><div class="nav"><li><a href="/">首页</a></li><li><a href="/archives">归档</a></li></div><div class="information"><div class="back_btn"><li><a class="fa fa-chevron-left" onclick="window.history.go(-1)"> </a></li></div></div></div><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post animated fadeInDown"><div class="post-title"><h1><a href="/2012/12/08/grunt-the-best/">Grunt -- 最好的前端构建框架</a></h1></div><div class="post-content"><p>每个前端开发工程师都会遇到前端文件打包、压缩的问题。</p>
<h2 id="Shell-gt-Ant-gt-Jake"><a href="#Shell-gt-Ant-gt-Jake" class="headerlink" title="Shell -&gt; Ant -&gt; Jake"></a>Shell -&gt; Ant -&gt; Jake</h2><p>最开始，我是用 shell 脚本调用 yuicompressor、cssmin 来压缩文件，非常简单，就像这样：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/env bash</span></span><br><span class="line"></span><br><span class="line">cat src/a.js src/b.js src/c.js &gt; dst/main.js</span><br><span class="line">yuicompressor main.js</span><br><span class="line"></span><br><span class="line">cat src/a.css src/b.css src/c.css &gt; dst/main.css</span><br><span class="line">cssmin main.css</span><br></pre></td></tr></table></figure>

<p>后来随着项目规模的逐渐增大，shell 脚本逐渐暴露出了很多问题，比如：</p>
<ul>
<li>不能自动下载依赖的外部命令，比如 yuicompressor/cssmin</li>
<li>缺乏变量替换功能</li>
<li>难以跨平台</li>
<li>代码难以维护</li>
</ul>
<p>因此 shell 脚本在到了近百行以后就被放弃了，取而代之的是 Ant。Ant 内置了一些常见任务，比如文件复制、合并、变量替换等，并且可以方便的通过编写自定义任务来扩展。得益于 Java 灵活的扩展性，Ant 任务可以非常方便的在各个项目之间分享，很好的解决了 shell 脚本代码难以维护和迁移的缺点。Ant 还可以结合 ivy 自动解决依赖，实现了完全的跨平台支持。</p>
<ul>
<li>推荐文章：<a href="http://www.36ria.com/4411" target="_blank" rel="noopener">ant入门指南—web前端开发七武器（1）</a></li>
</ul>
<p>但是，Ant 有个缺点：它是 Java 写的。Ant 如果要执行 js 代码，就必须通过 rhino，速度比 nodejs 慢了不少，作为一个 JavaScript 工程师，我非常希望可以直接用 js 来写构建脚本。</p>
<p>最终让我放弃 Ant 的是一个新的项目。这个项目的特殊之处在于它用了 maven 作为 Java 的构建工具。之前用的各种 Ant 任务也就没有了用武之地。尽管我可以将 Ant 的任务迁移到 mavn 下面，但是我更希望能找到一个和后台语言完全无关的构建系统。</p>
<p>因此在今年年初，我找到了一个 nodejs 环境下的构建框架 <a href="https://github.com/mde/jake" target="_blank" rel="noopener">Jake</a>。Jake 的各种编译任务由 <code>Jakefile</code> 中定义（这一点很像 Make），<code>Jakefile</code> 实际上就是一个 js 文件，通过 nodejs 来执行压缩合并等常见任务。</p>
<p>得益于 nodejs，Jake 执行 js 代码压缩的速度非常快，而且开发调试也更加方便。但是有个和 shell 脚本类似的问题：不同项目间的 Jake 任务难以重用，项目大了以后 <code>Jakefile</code> 依然很难维护，面对一个上千行的 <code>Jakefile</code>，和面对一个几百行的 shell 脚本的感觉差不了太多。</p>
<p>以上就是我从 Shell 到 Ant 再到 Jake 的折腾经历。经历这么一圈之后，我发现一个好用的构建框架应该具有以下三个特点：</p>
<ul>
<li>跨平台（Ant, Jake）</li>
<li>易维护、易迁移（Ant）</li>
<li>开发简单（Shell，Jake）</li>
</ul>
<p><a href="http://gruntjs.com" target="_blank" rel="noopener">grunt</a> 就是同时具有以上三个特点的前端构建框架。</p>
<h2 id="grunt"><a href="#grunt" class="headerlink" title="grunt"></a>grunt</h2><p><a href="http://gruntjs.com" target="_blank" rel="noopener">grunt</a> 是一个开源的基于任务 (Task) 的前端构建框架。它除了有 Jake 的优点（跨平台、开发简单）以外，还有一套设计良好的 task 框架用来组织各种构建任务。grunt 内置了几个非常常见的构建任务：</p>
<ul>
<li>concat - 组合各种文件</li>
<li>lint - 用 JSHint 检查代码</li>
<li>min - 用 UglifyJS 压缩代码</li>
<li>qunit - 跑 QUnit 单元测试</li>
<li>watch - 当源代码文件发生变化时自动执行任务</li>
</ul>
<p>除此之外还可以通过 npm 来方便的获取几百个现成的 task，比如用 closure 而不是 UglifyJS 来压缩 js，或者用 less 来生成 css，又或者用 jslint 而不是 jshint 来检查语法等，这些任务都可以在 npm 上找到。如果这些任务无法满足你的需求，grunt 还允许你方便的添加自定任务，就像写 nodejs 代码一样简单。自定任务还可以发布到 npm 上，通过 npm 在多个项目中共享这些任务。[fenbi-grunt-tasks] 就是粉笔网自定的 js 模块合并、handlebars 模板预编译任务 ([grunt-tbf2e] 貌似是淘宝的自定任务)。</p>
<p>任务之间的组合也是 grunt 非常好用的一个特性，例如通过 watch 任务和 rsync 任务的结合，可以方便的实现当源码发生改变时，自动同步代码到服务器上。</p>
<p>每次 grunt 执行时，grunt 都会去读取当前目录下的 <code>grunt.js</code> (就像 make 命令去寻找 Makefile 那样)，然后去读取其中的任务配置，例如源码目录等。grunt 最大的特点在于，配置文件中不包含任何的任务逻辑代码(OO 的开闭原则)。这一特性使得任务可以专心于“要做什么”而不是“要对什么做事情”，不再被特定的项目所绑架。</p>
<ul>
<li>推荐阅读：<a href="http://www.oschina.net/question/89964_47198" target="_blank" rel="noopener">grunt简要介绍–基于任务的JavaScript项目命令行构建工具</a></li>
</ul>
<p>grunt 给我最大的感受是：原来天下有这么多码农都在为前端构建而奋斗！grunt 使得各个项目的构建脚本不再彼此孤立，使得打造整个公司的前端构建工具变的更加简单。</p>
</div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2012-12-08</span><i class="fa fa-tag"></i><a class="tag" href="/tags/grunt/" title="grunt">grunt </a></div></div></div></div><div class="pagination"><ul class="clearfix"><li class="pre pagbuttons"><a class="btn" role="navigation" href="/2013/07/20/accurate-countdown-in-javascript/" title="setInterval 倒计时陷阱">上一篇</a></li><li class="next pagbuttons"><a class="btn" role="navigation" href="/2012/09/27/zsh/" title="使用 zsh 的九个理由">下一篇</a></li></ul></div></div></div></div></div><script src="/js/jquery.js"></script><script src="/js/jquery-migrate-1.2.1.min.js"></script><script src="/js/jquery.appear.js"></script></body></html>